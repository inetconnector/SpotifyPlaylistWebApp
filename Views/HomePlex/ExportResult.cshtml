@using System.Globalization
@using System.Text.Json
@using Microsoft.Extensions.Localization
@using SpotifyPlaylistWebApp
@inject IStringLocalizer<SharedResource> L
@{
    ViewData["Title"] = L["SpotifyToPlex_ExportTitle"];
    ViewData["BrowserTitle"] = L["SpotifyToPlex_ExportTitle"];
    ViewData["BodyClass"] = "min-h-screen bg-gradient-to-b from-[#0b0f17] to-[#141a27] text-white font-sans";
    ViewData["BodyStyle"] = "padding-top: 64px";
    ViewData["MainClass"] = "max-w-xl mx-auto mt-16 p-8 flex flex-col gap-6";
    ViewData["UseDefaultMainLayout"] = false;

    var data = TempData["ExportOneResult"]?.ToString();
    string exportedName = "", addedCount = "", missingCount = "";
    var hasData = false;

    if (!string.IsNullOrEmpty(data))
    {
        try
        {
            using var doc = JsonDocument.Parse(data);
            var root = doc.RootElement;
            exportedName = root.GetProperty("exportedName").GetString() ?? "";
            addedCount = root.GetProperty("addedCount").ToString();
            missingCount = root.GetProperty("missingCount").ToString();
            hasData = true;
        }
        catch
        {
            hasData = false;
        }
    }
}

@section HeadContent {
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <script src="https://cdn.tailwindcss.com"></script>
}

<div class="bg-white/5 rounded-3xl shadow-xl backdrop-blur-sm text-center px-4 py-8 md:px-8">
    <div class="flex justify-center mb-4">
        <img src="/images/plex-spotify.svg" alt="@L["SpotifyToPlex_LogoAlt"]"
             class="h-20 w-auto mx-auto drop-shadow-[0_0_8px_rgba(255,160,0,0.4)]"
             style="max-height:80px;"/>
    </div>

    <h1 class="text-3xl font-bold mb-3">@L["SpotifyToPlex_Title"]</h1>
    <p class="text-gray-300 mb-8">@L["Plex_ExportSummary"]</p>

    @if (hasData)
    {
        <div class="bg-green-700/40 border border-green-500 rounded-lg p-4 mb-6 text-left">
            <h2 class="text-xl font-semibold mb-2 text-green-300">✅ @exportedName</h2>
            <p class="text-gray-200">@L["Plex_ExportedTracks"]: <b>@addedCount</b></p>
            <p class="text-gray-200">@L["Plex_MissingTracks"]: <b>@missingCount</b></p>
        </div>
    }
    else
    {
        <div class="bg-red-600/30 border border-red-500 rounded-lg p-4 mb-6">
            ⚠️ @L["Plex_NoExportData"]
        </div>
    }

    <form method="get" action="/HomePlex/SpotifyToPlex">
        <button type="submit"
                class="w-full py-3.5 bg-gradient-to-r from-gray-700 to-gray-900 text-white font-semibold rounded-xl shadow-[0_4px_12px_rgba(0,0,0,0.3)] hover:brightness-110 active:translate-y-[1px] transition-all duration-150">
            ⬅️ @L["Plex_BackToOverview"]
        </button>
    </form>
</div>
